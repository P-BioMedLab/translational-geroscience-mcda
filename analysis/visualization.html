<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Analysis Figures</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: white;
            color: #333;
        }
        .figures-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .figure-panel {
            width: 100%;
            background: white;
            border: 1px solid #ddd;
            position: relative;
        }
        .figure-title {
            font-size: 14px;
            font-weight: bold;
            text-align: left;
            margin: 10px 15px 5px 15px;
            color: #000;
        }
        .chart-wrapper {
            width: calc(100% - 30px);
            height: 400px;
            margin: 10px 15px;
        }
        .figure-caption {
            font-size: 11px;
            text-align: justify;
            margin: 5px 15px 15px 15px;
            line-height: 1.3;
            color: #333;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <div class="figures-container">
        <!-- Figure 1: Rank Stability -->
        <div class="figure-panel">
            <div class="figure-title">
                Figure 4. Rank Stability Analysis: Monte Carlo Simulation of Weighted Scores with 95% Credible Intervals
            </div>
            
            <div class="chart-wrapper">
                <canvas id="rankStabilityChart"></canvas>
            </div>
            
            <div class="figure-caption">
                <strong>Monte Carlo analysis showing rank stability for top-tier geroscience interventions.</strong> 
                Error bars represent 95% credible intervals from 10,000 simulations where domain scores were sampled from 
                uniform distributions (±0.5 around assigned values). Top-tier repurposed drugs (Acarbose, SGLT2 inhibitors, 
                GLP-1 agonists, L-deprenyl) show narrow confidence intervals reflecting well-characterized evidence profiles. 
                Novel modalities show wider intervals indicating greater uncertainty. Weight perturbation analysis (±5%) 
                preserved top cluster ordering with occasional swaps between positions 1-2. Interventions ranked by baseline 
                weighted score with confidence intervals demonstrating stability of evidence-based rankings.
            </div>
        </div>

        <!-- Figure 2: Domain Contributions -->
        <div class="figure-panel">
            <div class="figure-title">
                Figure 5. Domain-wise Contribution Profiles: Weighted Score Decomposition Across Seven Evaluation Criteria
            </div>
            
            <div class="chart-wrapper">
                <canvas id="domainContributionChart"></canvas>
            </div>
            
            <div class="figure-caption">
                <strong>Stacked bar chart showing domain-wise contributions to final weighted scores for top 15 interventions.</strong> 
                Each segment represents weighted contribution from seven evaluation domains: Preclinical Efficacy (Lifespan, 20%), 
                Preclinical Efficacy (Healthspan, 10%), Mechanism Conservation (10%), Human Trial Evidence (20%), Safety & 
                Tolerability (20%), Biomarker Availability (10%), and Cost & Accessibility (10%). Top-tier interventions 
                (Acarbose, SGLT2 inhibitors) derive strength primarily from safety and human evidence domains. High-risk 
                interventions (Epigenetic Reprogramming) show strong preclinical contributions but limited human validation. 
                Color coding enables identification of translational readiness patterns across intervention categories.
            </div>
        </div>
    </div>

    <script>
        // Data from the paper's scoring matrix and Monte Carlo results
        const rankStabilityData = {
            interventions: [
                'Acarbose', 'SGLT2 inhibitors', 'GLP-1 agonists', 'L-deprenyl', 'Rapamycin',
                'Metformin', 'NAD+ Restoration', 'GlyNAC', 'Gut Microbiome', 'Urolithin A',
                'Spermidine', 'Senolytics D+Q', 'AKG', 'Fisetin', 'Anti-inflammatory'
            ],
            baselineScores: [3.7, 3.7, 3.6, 3.6, 3.5, 3.5, 3.5, 3.4, 3.4, 3.4, 3.3, 3.1, 3.1, 3.1, 3.1],
            ciLower: [3.47, 3.48, 3.38, 3.37, 3.27, 3.30, 3.27, 3.17, 3.18, 3.18, 3.06, 2.88, 2.87, 2.87, 2.88],
            ciUpper: [3.90, 3.93, 3.82, 3.83, 3.73, 3.64, 3.71, 3.63, 3.62, 3.62, 3.51, 3.32, 3.33, 3.33, 3.32]
        };

        // Domain contribution data from scoring matrix
        const domainData = {
            interventions: [
                'Acarbose', 'SGLT2 inhibitors', 'GLP-1 agonists', 'L-deprenyl', 'Rapamycin',
                'Metformin', 'NAD+ Restoration', 'GlyNAC', 'Gut Microbiome', 'Urolithin A',
                'Spermidine', 'Senolytics D+Q', 'AKG', 'Fisetin', 'Epigenetic Reprogram'
            ],
            // Weighted contributions (score * weight)
            lifespan: [0.8, 0.6, 0.6, 0.8, 0.8, 0.2, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 1.0],
            healthspan: [0.4, 0.4, 0.4, 0.3, 0.4, 0.3, 0.3, 0.3, 0.3, 0.4, 0.4, 0.4, 0.3, 0.3, 0.4],
            conservation: [0.4, 0.4, 0.4, 0.4, 0.5, 0.5, 0.5, 0.4, 0.4, 0.4, 0.5, 0.4, 0.4, 0.4, 0.4],
            humanTrials: [0.6, 0.8, 0.8, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.4, 0.6, 0.4, 0.4, 0.4],
            safety: [0.6, 0.8, 0.8, 0.8, 0.6, 1.0, 0.8, 0.8, 0.8, 0.8, 0.8, 0.6, 0.8, 0.8, 0.4],
            biomarkers: [0.4, 0.4, 0.4, 0.3, 0.3, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.3, 0.2, 0.2, 0.4],
            cost: [0.5, 0.3, 0.2, 0.4, 0.3, 0.5, 0.3, 0.4, 0.4, 0.3, 0.4, 0.2, 0.4, 0.4, 0.1]
        };

        // Create Figure 1: Rank Stability Chart
        const ctx1 = document.getElementById('rankStabilityChart').getContext('2d');
        
        // Shorten intervention names for better display
        const shortNames = [
            'Acarbose', 'SGLT2 inhibitors', 'GLP-1 agonists', 'L-deprenyl', 'Rapamycin',
            'Metformin', 'NAD+ Restoration', 'GlyNAC', 'Gut Microbiome', 'Urolithin A',
            'Spermidine', 'Senolytics D+Q', 'AKG', 'Fisetin', 'Epigenetic Reprogram'
        ];

        new Chart(ctx1, {
            type: 'scatter',
            data: {
                labels: shortNames,
                datasets: [
                    {
                        label: 'Baseline Weighted Score',
                        data: rankStabilityData.baselineScores,
                        backgroundColor: 'rgba(70, 130, 180, 0.8)',
                        borderColor: 'rgba(70, 130, 180, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'category',
                        title: {
                            display: true,
                            text: 'Geroscience Interventions (ranked by weighted score)',
                            font: { size: 12, weight: 'bold', family: 'Arial' },
                            color: '#000'
                        },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45,
                            font: { size: 9, family: 'Arial' },
                            color: '#000'
                        },
                        grid: { display: false }
                    },
                    y: {
                        min: 2.8,
                        max: 4.0,
                        title: {
                            display: true,
                            text: 'Weighted Score',
                            font: { size: 12, weight: 'bold', family: 'Arial' },
                            color: '#000'
                        },
                        ticks: {
                            font: { size: 10, family: 'Arial' },
                            color: '#000'
                        },
                        grid: { color: 'rgba(0,0,0,0.1)' }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return rankStabilityData.interventions[context[0].dataIndex];
                            },
                            label: function(context) {
                                const index = context.dataIndex;
                                const score = context.parsed.y;
                                const lower = rankStabilityData.ciLower[index];
                                const upper = rankStabilityData.ciUpper[index];
                                return [
                                    `Score: ${score.toFixed(2)}`,
                                    `95% CI: ${lower.toFixed(2)} - ${upper.toFixed(2)}`
                                ];
                            }
                        }
                    }
                },
                // Add error bars using afterDatasetsDraw
                onHover: function(event, activeElements) {
                    event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                }
            },
            plugins: [{
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    const meta = chart.getDatasetMeta(0);
                    
                    ctx.save();
                    ctx.strokeStyle = 'rgba(70, 130, 180, 0.8)';
                    ctx.lineWidth = 1.5;
                    
                    meta.data.forEach((point, index) => {
                        const x = point.x;
                        const yLower = chart.scales.y.getPixelForValue(rankStabilityData.ciLower[index]);
                        const yUpper = chart.scales.y.getPixelForValue(rankStabilityData.ciUpper[index]);
                        
                        // Draw vertical error bar
                        ctx.beginPath();
                        ctx.moveTo(x, yLower);
                        ctx.lineTo(x, yUpper);
                        ctx.stroke();
                        
                        // Draw caps
                        ctx.beginPath();
                        ctx.moveTo(x - 3, yLower);
                        ctx.lineTo(x + 3, yLower);
                        ctx.moveTo(x - 3, yUpper);
                        ctx.lineTo(x + 3, yUpper);
                        ctx.stroke();
                    });
                    
                    ctx.restore();
                }
            }]
        });

        // Create Figure 2: Domain Contribution Chart
        const ctx2 = document.getElementById('domainContributionChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: domainData.interventions,
                datasets: [
                    {
                        label: 'Preclinical Lifespan (20%)',
                        data: domainData.lifespan,
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Preclinical Healthspan (10%)',
                        data: domainData.healthspan,
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Mechanism Conservation (10%)',
                        data: domainData.conservation,
                        backgroundColor: 'rgba(255, 206, 86, 0.8)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Human Trial Evidence (20%)',
                        data: domainData.humanTrials,
                        backgroundColor: 'rgba(75, 192, 192, 0.8)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Safety & Tolerability (20%)',
                        data: domainData.safety,
                        backgroundColor: 'rgba(153, 102, 255, 0.8)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Biomarker Availability (10%)',
                        data: domainData.biomarkers,
                        backgroundColor: 'rgba(255, 159, 64, 0.8)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Cost & Accessibility (10%)',
                        data: domainData.cost,
                        backgroundColor: 'rgba(199, 199, 199, 0.8)',
                        borderColor: 'rgba(199, 199, 199, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Geroscience Interventions (ranked by total weighted score)',
                            font: { size: 12, weight: 'bold', family: 'Arial' },
                            color: '#000'
                        },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45,
                            font: { size: 9, family: 'Arial' },
                            color: '#000'
                        },
                        grid: { display: false }
                    },
                    y: {
                        stacked: true,
                        min: 0,
                        max: 4.0,
                        title: {
                            display: true,
                            text: 'Weighted Score Contribution',
                            font: { size: 12, weight: 'bold', family: 'Arial' },
                            color: '#000'
                        },
                        ticks: {
                            font: { size: 10, family: 'Arial' },
                            color: '#000'
                        },
                        grid: { color: 'rgba(0,0,0,0.1)' }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 10,
                            font: { size: 9, family: 'Arial' },
                            color: '#000',
                            usePointStyle: false,
                            boxWidth: 12,
                            boxHeight: 12
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        titleFont: { size: 11, family: 'Arial' },
                        bodyFont: { size: 10, family: 'Arial' },
                        callbacks: {
                            title: function(context) {
                                return context[0].label;
                            },
                            afterBody: function(context) {
                                const total = context.reduce((sum, item) => sum + item.parsed.y, 0);
                                return `Total Score: ${total.toFixed(2)}`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>